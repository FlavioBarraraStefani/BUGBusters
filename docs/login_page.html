<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BUGBusters Private CSV Viewer</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    input, button { padding: 0.5em; font-size: 1em; }
    pre { background: #f0f0f0; padding: 1em; border-radius: 5px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>BUGBusters Private CSV Viewer</h2>
  <div id="status">Initializing...</div>

  <div id="tokenInput" style="display:none; margin-top:1em;">
    <input type="password" id="token" placeholder="Enter your GitHub Personal Access Token" size="50">
    <button onclick="saveToken()">Submit</button>
  </div>

  <pre id="csv"></pre>

  <script>
const API_URL = "https://api.github.com/repos/supernino02/BugBuster-project/contents/example.csv";
const statusEl = document.getElementById("status");
const csvEl = document.getElementById("csv");
const tokenInputEl = document.getElementById("tokenInput");

// Fetch CSV using the token
async function fetchCSV(token) {
  try {
    const res = await fetch(API_URL, {
      headers: { Authorization: `token ${token}` }
    });

    if (!res.ok) {
      // Invalid token or not a collaborator
      localStorage.removeItem("github_token");
      statusEl.textContent = "Access denied or invalid token. Please enter a valid token.";
      tokenInputEl.style.display = "block";
      csvEl.textContent = "";
      return;
    }

    const data = await res.json();
    const csvText = atob(data.content);
    statusEl.textContent = "CSV Loaded:";
    csvEl.textContent = csvText;

  } catch (err) {
    statusEl.textContent = "Error fetching CSV: " + err.message;
    tokenInputEl.style.display = "block";
    csvEl.textContent = "";
  }
}

// Save token from input
function saveToken() {
  const token = document.getElementById("token").value.trim();
  if (!token) return;
  localStorage.setItem("github_token", token);
  tokenInputEl.style.display = "none";
  statusEl.textContent = "Fetching CSV...";
  fetchCSV(token);
}

// Main
const savedToken = localStorage.getItem("github_token");
if (savedToken) {
  statusEl.textContent = "Using cached token...";
  fetchCSV(savedToken);
} else {
  statusEl.textContent = "No token found. Please enter your GitHub Personal Access Token:";
  tokenInputEl.style.display = "block";
}

  </script>
</body>
</html>
